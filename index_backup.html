<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>仙缘录 - 乙女仙侠游戏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // 配置Tailwind主题
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF9EBB', // 柔和粉色
                        secondary: '#B69FFF', // 淡紫色
                        accent: '#FFD166', // 淡金色
                        light: '#FFF5F8', // 浅粉色背景
                        dark: '#7B61AA', // 深紫色文字
                        neutral: '#FDF2F7' // 极浅粉色
                    },
                    fontFamily: {
                        fantasy: ['Garamond', 'Georgia', 'serif'],
                        sans: ['Noto Sans SC', 'sans-serif']
                    },
                    backgroundImage: {
                        'clearday': 'linear-gradient(135deg, #FFEFF5 0%, #FFD6E5 100%)',
                        'forest': 'linear-gradient(135deg, #F0F7FF 0%, #D9E7FF 100%)',
                        'market': 'linear-gradient(135deg, #FFF5FF 0%, #F0E5FF 100%)',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }
            .text-shadow-glow {
                text-shadow: 0 0 15px rgba(255, 158, 187, 0.6);
            }
            .bg-blur {
                backdrop-filter: blur(8px);
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .animate-float {
                animation: float 6s ease-in-out infinite;
            }
            .animate-pulse-slow {
                animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .nav-button-active {
                background-color: rgba(255, 158, 187, 0.2);
                border-color: rgba(255, 158, 187, 0.8);
            }
            .card-shadow {
                box-shadow: 0 10px 25px -5px rgba(255, 158, 187, 0.1), 0 8px 10px -6px rgba(255, 158, 187, 0.1);
            }
            .message-appear {
                animation: messageAppear 0.3s ease-out forwards;
            }
            @keyframes float {
                0% { transform: translateY(0px); }
                50% { transform: translateY(-15px); }
                100% { transform: translateY(0px); }
            }
            @keyframes messageAppear {
                from { transform: scale(0.9); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
        }
    </style>
</head>
<body class="bg-light min-h-screen font-fantasy text-dark overflow-x-hidden flex flex-col">
    <!-- 页面加载指示器 -->
    <div id="loader" class="fixed inset-0 z-50 flex items-center justify-center bg-white">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-xl text-dark">仙缘录加载中...</p>
        </div>
    </div>

    <!-- 顶部导航 -->
    <header class="bg-white/70 bg-blur border-b border-primary/40 sticky top-0 z-40 hidden">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fa fa-pagelines text-accent text-3xl animate-pulse-slow"></i>
                <h1 class="text-[clamp(1.8rem,4vw,3rem)] font-bold text-shadow-glow">仙缘录</h1>
            </div>
            
            <!-- 主导航按钮 - PC端优化 -->
            <nav class="hidden md:flex space-x-4">
                <button id="map-btn" class="nav-btn flex items-center space-x-2 bg-white/40 border border-primary/40 rounded-lg px-4 py-2 hover:bg-primary/20 transition-all duration-300 text-dark">
                    <i class="fa fa-map-o text-xl"></i>
                    <span class="text-lg">地图</span>
                </button>
                <button id="profile-btn" class="nav-btn flex items-center space-x-2 bg-white/40 border border-primary/40 rounded-lg px-4 py-2 hover:bg-primary/20 transition-all duration-300 text-dark">
                    <i class="fa fa-user-o text-xl"></i>
                    <span class="text-lg">个人</span>
                </button>
                <button id="alchemy-btn" class="nav-btn flex items-center space-x-2 bg-white/40 border border-primary/40 rounded-lg px-4 py-2 hover:bg-primary/20 transition-all duration-300 text-dark">
                    <i class="fa fa-flask text-xl"></i>
                    <span class="text-lg">炼丹</span>
                </button>
                <button id="shop-btn" class="nav-btn flex items-center space-x-2 bg-white/40 border border-primary/40 rounded-lg px-4 py-2 hover:bg-primary/20 transition-all duration-300 text-dark">
                    <i class="fa fa-shopping-bag text-xl"></i>
                    <span class="text-lg">商店</span>
                </button>
                <button id="characters-btn" class="nav-btn flex items-center space-x-2 bg-white/40 border border-primary/40 rounded-lg px-4 py-2 hover:bg-primary/20 transition-all duration-300 text-dark">
                    <i class="fa fa-users text-xl"></i>
                    <span class="text-lg">人物</span>
                </button>
            </nav>
            
            <div class="flex items-center space-x-5">
                <div class="flex items-center bg-white/50 rounded-full px-4 py-2">
                    <i class="fa fa-diamond text-accent mr-2 text-xl"></i>
                    <span id="gold-count" class="text-lg font-bold">1000</span>
                </div>
                <button class="md:hidden text-2xl" id="mobile-menu-btn">
                    <i class="fa fa-bars"></i>
                </button>
            </div>
        </div>
        
        <!-- 移动端菜单 -->
        <div id="mobile-menu" class="md:hidden hidden bg-white/90 bg-blur">
            <div class="container mx-auto px-4 py-3 flex flex-col space-y-3">
                <button id="map-btn-mobile" class="hover:text-primary transition-colors duration-300 flex items-center py-3 px-2">
                    <i class="fa fa-map-o mr-3 w-6 text-xl"></i> 地图
                </button>
                <button id="profile-btn-mobile" class="hover:text-primary transition-colors duration-300 flex items-center py-3 px-2">
                    <i class="fa fa-user-o mr-3 w-6 text-xl"></i> 个人
                </button>
                <button id="alchemy-btn-mobile" class="hover:text-primary transition-colors duration-300 flex items-center py-3 px-2">
                    <i class="fa fa-flask mr-3 w-6 text-xl"></i> 炼丹
                </button>
                <button id="shop-btn-mobile" class="hover:text-primary transition-colors duration-300 flex items-center py-3 px-2">
                    <i class="fa fa-shopping-bag mr-3 w-6 text-xl"></i> 商店
                </button>
                <button id="characters-btn-mobile" class="hover:text-primary transition-colors duration-300 flex items-center py-3 px-2">
                    <i class="fa fa-users mr-3 w-6 text-xl"></i> 人物
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex-1 container mx-auto px-6 py-8 hidden" id="main-content">
        <!-- 初始欢迎界面 -->
        <section id="welcome-screen" class="flex flex-col lg:flex-row items-center justify-center min-h-[80vh] text-center lg:text-left p-4">
            <div class="w-full lg:w-1/2 mb-10 lg:mb-0 lg:pr-10 order-2 lg:order-1">
                <h2 class="text-[clamp(2rem,5vw,4rem)] font-bold mb-6 text-shadow-glow">欢迎来到仙缘录</h2>
                <p class="text-[clamp(1.1rem,2vw,1.5rem)] max-w-2xl mb-8 bg-white/60 bg-blur p-6 rounded-lg leading-relaxed text-dark">你将扮演一位天赋异禀的药修小师姐"灵月"，在仙门中修炼成长。清冷出尘的师尊、腹黑的小师弟，还有神秘莫测的魔尊，谁将与你结下不解仙缘？</p>
                <button id="start-btn" class="bg-primary hover:bg-primary/80 text-white font-bold py-4 px-10 rounded-full text-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
                    开始你的仙缘之旅 <i class="fa fa-arrow-right ml-2"></i>
                </button>
            </div>
            
            <div class="w-full lg:w-1/2 order-1 lg:order-2 flex justify-center">
                <!-- 立绘区域 -->
                <img src="https://img.cdn1.vip/i/68b1b902c7a33_1756477698.webp" alt="仙缘录游戏主角灵月" class="rounded-xl shadow-2xl max-h-[70vh] object-cover border-4 border-primary/30 animate-float">
            </div>
        </section>

        <!-- 地图界面 -->
        <section id="map-screen" class="hidden min-h-[80vh]">
            <div class="bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 rounded-2xl p-6 md:p-10 shadow-2xl border border-primary/30 h-full">
                <h2 class="text-[clamp(1.8rem,4vw,3rem)] font-bold mb-8 text-shadow-glow text-center">仙门地图</h2>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- 地图地点 -->
                    <div class="map-location bg-white/80 rounded-xl p-5 border-2 border-pink-100 hover:border-primary transition-all duration-300 cursor-pointer transform hover:-translate-y-2 card-shadow" data-location="clearday" data-character="master">
                        <div class="w-full h-48 bg-gradient-to-br from-pink-100 to-pink-200 rounded-lg mb-4 overflow-hidden">
                            <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/56264cd8790b41f2934cf439235e8255~tplv-a9rns2rl98-image.image?rcl=2025081422344118F89A2763343FB67670&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755786882&amp;x-signature=OobOHC%2B7GW2Pd3tDqvPGGI8NrmQ%3D" alt="清修殿场景" class="w-full h-full object-cover">
                        </div>
                        <h3 class="text-xl font-bold mb-2 flex items-center">
                            <i class="fa fa-home text-primary mr-2"></i> 清修殿
                        </h3>
                        <p class="text-dark/80">师尊平日静修之地，偶尔能遇到他...</p>
                    </div>
                    
                    <div class="map-location bg-white/80 rounded-xl p-5 border-2 border-blue-100 hover:border-blue-300 transition-all duration-300 cursor-pointer transform hover:-translate-y-2 card-shadow" data-location="forest" data-character="junior">
                        <div class="w-full h-48 bg-gradient-to-br from-blue-100 to-blue-200 rounded-lg mb-4 overflow-hidden">
                            <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/5a721e2648704105965567f22237a5f0~tplv-a9rns2rl98-image.image?rcl=20250814221849CED01553A2A05CB21E97&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785930&amp;x-signature=m1atuh%2FPe3Vemqbdsbb6GLNkw8E%3D" alt="练剑场场景" class="w-full h-full object-cover">
                        </div>
                        <h3 class="text-xl font-bold mb-2 flex items-center">
                            <i class="fa fa-balance-scale text-blue-400 mr-2"></i> 练剑场
                        </h3>
                        <p class="text-dark/80">小师弟常在此练习剑法，或许会遇到他...</p>
                    </div>
                    
                    <div class="map-location bg-white/80 rounded-xl p-5 border-2 border-green-100 hover:border-green-300 transition-all duration-300 cursor-pointer transform hover:-translate-y-2 card-shadow" data-location="market" data-character="master">
                        <div class="w-full h-48 bg-gradient-to-br from-green-100 to-green-200 rounded-lg mb-4 overflow-hidden">
                            <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/f8477ff0b580441bbf60115992d77091~tplv-a9rns2rl98-image.image?rcl=20250814221647499B597FD299B1B31784&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785809&amp;x-signature=%2FXGP3MnxXzcnh3ehs%2BNOThV1Hhw%3D" alt="药园场景" class="w-full h-full object-cover">
                        </div>
                        <h3 class="text-xl font-bold mb-2 flex items-center">
                            <i class="fa fa-leaf text-green-400 mr-2"></i> 药园
                        </h3>
                        <p class="text-dark/80">种植着各种灵药，是你平日工作的地方...</p>
                    </div>
                    
                    <div class="map-location bg-white/80 rounded-xl p-5 border-2 border-teal-100 hover:border-teal-300 transition-all duration-300 cursor-pointer transform hover:-translate-y-2 card-shadow" data-location="forest" data-character="junior">
                        <div class="w-full h-48 bg-gradient-to-br from-teal-100 to-teal-200 rounded-lg mb-4 overflow-hidden">
                            <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/0528741e64f24891b6704855141a685a~tplv-a9rns2rl98-image.image?rcl=20250814221715EB482094172757B95DC9&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785836&amp;x-signature=YyKS4EYc6epDXBu6QAq4ev1XcSY%3D" alt="后山场景" class="w-full h-full object-cover">
                        </div>
                        <h3 class="text-xl font-bold mb-2 flex items-center">
                            <i class="fa fa-tree text-teal-400 mr-2"></i> 后山
                        </h3>
                        <p class="text-dark/80">人迹罕至，偶尔会有意外的相遇...</p>
                    </div>
                    
                    <div class="map-location bg-white/80 rounded-xl p-5 border-2 border-purple-100 hover:border-purple-300 transition-all duration-300 cursor-pointer transform hover:-translate-y-2 card-shadow" data-location="market" data-character="demon">
                        <div class="w-full h-48 bg-gradient-to-br from-purple-100 to-purple-200 rounded-lg mb-4 overflow-hidden">
                            <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/1d502978d1524dbdbb0056d3ced0690a~tplv-a9rns2rl98-image.image?rcl=202508142217373CC74099238676086369&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785858&amp;x-signature=mgn5zhE8T4ymUauspENfo8coIPk%3D" alt="仙门集市场景" class="w-full h-full object-cover">
                        </div>
                        <h3 class="text-xl font-bold mb-2 flex items-center">
                            <i class="fa fa-shopping-basket text-purple-400 mr-2"></i> 仙门集市
                        </h3>
                        <p class="text-dark/80">可以出售丹药，或许能遇到有趣的人...</p>
                    </div>
                    
                    <div class="map-location bg-white/80 rounded-xl p-5 border-2 border-indigo-100 hover:border-indigo-300 transition-all duration-300 cursor-pointer transform hover:-translate-y-2 card-shadow" data-location="clearday" data-character="demon">
                        <div class="w-full h-48 bg-gradient-to-br from-indigo-100 to-indigo-200 rounded-lg mb-4 overflow-hidden">
                            <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/636b33e8fa30414c8aa8788dc042fe3f~tplv-a9rns2rl98-image.image?rcl=202508142217502264C10D9DBF1AA8E743&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785871&amp;x-signature=T0mcwu%2FfauihyOvfxZfL0IJKqqI%3D" alt="神秘之地场景" class="w-full h-full object-cover">
                        </div>
                        <h3 class="text-xl font-bold mb-2 flex items-center">
                            <i class="fa fa-question-circle text-indigo-400 mr-2"></i> 神秘之地
                        </h3>
                        <p class="text-dark/80">被迷雾笼罩的区域，充满未知...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 个人界面 -->
        <section id="profile-screen" class="hidden min-h-[80vh]">
            <div class="bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 rounded-2xl p-6 md:p-10 shadow-2xl border border-primary/30 h-full">
                <h2 class="text-[clamp(1.8rem,4vw,3rem)] font-bold mb-8 text-shadow-glow text-center">个人信息</h2>
                
                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- 主角信息 -->
                    <div class="lg:w-1/3 bg-white/80 rounded-xl p-6 border border-primary/30 card-shadow">
                        <div class="text-center mb-6">
                            <div class="w-40 h-40 rounded-full border-4 border-primary/70 mx-auto mb-4 overflow-hidden">
                                <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/79e7179ffc0b49f88751399588e5e14c~tplv-a9rns2rl98-image.image?rcl=20250814221508CDDA694D2E38BF2EEDF0&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785709&amp;x-signature=2zkoRUTNAiKFSExzFEOIaTiNoU8%3D" alt="主角灵月头像" class="w-full h-full object-cover">
                            </div>
                            <h3 class="text-2xl font-bold">灵月 (你)</h3>
                            <p class="text-dark/80">药修 · 炼气期三层</p>
                        </div>
                        
                        <div class="space-y-4 mt-8">
                            <div class="flex justify-between items-center">
                                <span class="text-lg">修为进度</span>
                                <div class="w-2/3 bg-pink-100 rounded-full h-3">
                                    <div class="bg-primary h-3 rounded-full" style="width: 30%"></div>
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-lg">炼丹术</span>
                                <div class="w-2/3 bg-purple-100 rounded-full h-3">
                                    <div class="bg-secondary h-3 rounded-full" style="width: 45%"></div>
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-lg">草药知识</span>
                                <div class="w-2/3 bg-yellow-100 rounded-full h-3">
                                    <div class="bg-accent h-3 rounded-full" style="width: 60%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 好感度面板 -->
                    <div class="lg:w-2/3 bg-white/80 rounded-xl p-6 border border-primary/30 card-shadow">
                        <h3 class="text-xl font-bold mb-6 flex items-center">
                            <i class="fa fa-heart text-primary mr-2"></i> 角色好感度
                        </h3>
                        
                        <div class="space-y-8">
                            <!-- 师尊 -->
                            <div class="flex items-center gap-6 p-4 bg-pink-50 rounded-lg hover:bg-pink-100 transition-colors">
                                <div class="w-20 h-20 rounded-full border-2 border-primary/70 overflow-hidden">
                                    <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/0fae5d8f5d514362a9b9dc50014d81c0~tplv-a9rns2rl98-image.image?rcl=20250814221528F4602D54EC25C149BA00&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785729&amp;x-signature=%2F8oqg2gIcGAX8oHhukgYB9q9JNQ%3D" alt="玄尘师尊头像" class="w-full h-full object-cover">
                                </div>
                                <div class="flex-1">
                                    <div class="flex justify-between items-center mb-2">
                                        <h4 class="font-bold text-xl">玄尘师尊</h4>
                                        <span class="text-accent text-lg">好感度: 35/100</span>
                                    </div>
                                    <div class="w-full bg-pink-100 rounded-full h-3 mb-3">
                                        <div class="bg-primary h-3 rounded-full" style="width: 35%"></div>
                                    </div>
                                    <p class="text-dark/70">清冷出尘，修为高深，对弟子要求严格但内心关怀</p>
                                </div>
                                <button class="view-character-details bg-primary/30 hover:bg-primary/50 text-white py-2 px-4 rounded-full transition-colors" data-character="master">
                                    详情
                                </button>
                            </div>
                            
                            <!-- 小师弟 -->
                            <div class="flex items-center gap-6 p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors">
                                <div class="w-20 h-20 rounded-full border-2 border-blue-300 overflow-hidden">
                                    <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/02d2ff9f9a3540729636a8c40fea989b~tplv-a9rns2rl98-image.image?rcl=20250814221540F4602D54EC25C149C391&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785740&amp;x-signature=YHcBN2o2hEhF7BQfYQvY%2Bbp2Zx8%3D" alt="夜宸小师弟头像" class="w-full h-full object-cover">
                                </div>
                                <div class="flex-1">
                                    <div class="flex justify-between items-center mb-2">
                                        <h4 class="font-bold text-xl">夜宸小师弟</h4>
                                        <span class="text-accent text-lg">好感度: 52/100</span>
                                    </div>
                                    <div class="w-full bg-blue-100 rounded-full h-3 mb-3">
                                        <div class="bg-blue-400 h-3 rounded-full" style="width: 52%"></div>
                                    </div>
                                    <p class="text-dark/70">表面乖巧，实则心思缜密，总爱跟在你身后师姐师姐地叫</p>
                                </div>
                                <button class="view-character-details bg-blue-400/30 hover:bg-blue-400/50 text-white py-2 px-4 rounded-full transition-colors" data-character="junior">
                                    详情
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 炼丹界面 -->
        <section id="alchemy-screen" class="hidden min-h-[80vh]">
            <div class="bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 rounded-2xl p-6 md:p-10 shadow-2xl border border-primary/30 h-full">
                <h2 class="text-[clamp(1.8rem,4vw,3rem)] font-bold mb-8 text-shadow-glow text-center">炼丹房</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- 草药列表 -->
                    <div class="bg-white/80 rounded-xl p-6 border border-primary/30 card-shadow">
                        <h3 class="text-xl font-bold mb-6 flex items-center">
                            <i class="fa fa-pagelines text-primary mr-2"></i> 草药库存
                        </h3>
                        
                        <div class="space-y-4 max-h-[600px] overflow-y-auto scrollbar-hide pr-2">
                            <div class="flex justify-between items-center p-3 bg-green-50 rounded hover:bg-green-100 transition-colors">
                                <div class="flex items-center">
                                    <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/de895b212a174b27bd3a968630849076~tplv-a9rns2rl98-image.image?rcl=20250814221924B849CDFF34E1CD8D6E1D&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785965&amp;x-signature=AuhlMHEq44%2FAzw1eMizi%2BQAgIAQ%3D" alt="灵叶草" class="w-8 h-8 rounded-full mr-3">
                                    <span class="text-lg">灵叶草</span>
                                </div>
                                <span class="bg-green-100 px-3 py-1 rounded text-sm">x25</span>
                            </div>
                            
                            <div class="flex justify-between items-center p-3 bg-blue-50 rounded hover:bg-blue-100 transition-colors">
                                <div class="flex items-center">
                                    <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/3153c9a9c39e400b835f3f8eae475513~tplv-a9rns2rl98-image.image?rcl=2025081422193438B0369459A10249D542&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785975&amp;x-signature=czKF3JUMWv99Sk8zi5DSuBqHL2g%3D" alt="冰心花" class="w-8 h-8 rounded-full mr-3">
                                    <span class="text-lg">冰心花</span>
                                </div>
                                <span class="bg-blue-100 px-3 py-1 rounded text-sm">x18</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 炼丹炉 -->
                    <div class="bg-white/80 rounded-xl p-6 border border-primary/30 card-shadow flex flex-col items-center justify-center">
                        <h3 class="text-xl font-bold mb-8 flex items-center">
                            <i class="fa fa-fire text-primary mr-2"></i> 炼丹炉
                        </h3>
                        
                        <div class="relative mb-8">
                            <div class="w-64 h-64 md:w-80 md:h-80 rounded-full bg-gradient-to-br from-pink-200 to-purple-200 flex items-center justify-center animate-pulse-slow">
                                <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/39f0bc10839746abb2070804239b0ef8~tplv-a9rns2rl98-image.image?rcl=20250814221405AEF3CD9A7549237EEED3&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785646&amp;x-signature=yuk3hTCpZf3U653ptZFOZd1VsnM%3D" alt="炼丹炉" class="w-56 h-56 md:w-72 md:h-72 rounded-full object-cover">
                            </div>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div id="alchemy-progress" class="w-24 h-24 rounded-full border-4 border-primary/30 border-t-primary flex items-center justify-center text-2xl font-bold">
                                    开始
                                </div>
                            </div>
                        </div>
                        
                        <div class="w-full max-w-xs mb-6">
                            <h4 class="text-center font-bold mb-3">选择丹方</h4>
                            <div class="grid grid-cols-3 gap-2">
                                <button class="select-pill bg-primary/30 hover:bg-primary/50 text-white py-2 px-1 rounded transition-colors text-sm bg-primary" data-pill="回春丹">回春丹</button>
                                <button class="select-pill bg-primary/30 hover:bg-primary/50 text-white py-2 px-1 rounded transition-colors text-sm" data-pill="凝神丹">凝神丹</button>
                                <button class="select-pill bg-primary/30 hover:bg-primary/50 text-white py-2 px-1 rounded transition-colors text-sm" data-pill="清心丹">清心丹</button>
                            </div>
                        </div>
                        
                        <button id="start-alchemy" class="bg-primary hover:bg-primary/80 text-white font-bold py-3 px-8 rounded-full text-lg transition-all duration-300 transform hover:scale-105">
                            开始炼丹 <i class="fa fa-play ml-1"></i>
                        </button>
                    </div>
                    
                    <!-- 丹药列表 -->
                    <div class="bg-white/80 rounded-xl p-6 border border-primary/30 card-shadow">
                        <h3 class="text-xl font-bold mb-6 flex items-center">
                            <i class="fa fa-flask text-primary mr-2"></i> 丹药库存
                        </h3>
                        
                        <div class="space-y-5 max-h-[600px] overflow-y-auto scrollbar-hide pr-2">
                            <div class="p-4 bg-pink-50 rounded hover:bg-pink-100 transition-colors">
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="font-bold text-lg">回春丹</h4>
                                    <div class="flex items-center">
                                        <span class="text-accent mr-3">x12</span>
                                        <button class="sell-pill bg-secondary/70 hover:bg-secondary text-sm px-3 py-1 rounded">出售</button>
                                    </div>
                                </div>
                                <div class="flex items-center mb-2">
                                    <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/c4e99b991dc74fa4a37c1f0b6b128ba8~tplv-a9rns2rl98-image.image?rcl=202508142220249FC9F6E19E49BCA668B3&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755786026&amp;x-signature=FaUO679pJqETlJSPJbEKeE%2FnTPs%3D" alt="回春丹" class="w-8 h-8 rounded-full mr-3">
                                    <p class="text-dark/70">基础疗伤丹药，可恢复少量灵力</p>
                                </div>
                                <p class="text-xs text-accent mt-2">价值: 50 金币</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 商店界面 -->
        <section id="shop-screen" class="hidden min-h-[80vh]">
            <div class="bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 rounded-2xl p-6 md:p-10 shadow-2xl border border-primary/30 h-full">
                <h2 class="text-[clamp(1.8rem,4vw,3rem)] font-bold mb-8 text-shadow-glow text-center">神秘商店</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- 商品 -->
                    <div class="bg-white rounded-xl overflow-hidden border border-pink-100 hover:border-primary transition-all duration-300 transform hover:-translate-y-2 card-shadow">
                        <div class="h-52 bg-gradient-to-br from-pink-100 to-pink-200 flex items-center justify-center">
                            <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/2519db0e0256465fb4434ef2323b32d3~tplv-a9rns2rl98-image.image?rcl=20250814221158356896DD9FD56B720388&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785519&amp;x-signature=vJtr88X4sJwtH6gp22EXfzXpXVU%3D" alt="清心草" class="h-full w-full object-cover">
                        </div>
                        <div class="p-5">
                            <div class="flex justify-between items-start mb-3">
                                <h3 class="font-bold text-xl">清心草</h3>
                                <span class="bg-primary/20 text-primary text-sm px-3 py-1 rounded">师尊喜好</span>
                            </div>
                            <p class="text-sm text-dark/70 mb-4">带有清冽香气的草药，能平静心神</p>
                            <div class="flex justify-between items-center">
                                <span class="text-accent font-bold text-lg">150 金币</span>
                                <button class="buy-item bg-primary hover:bg-primary/80 text-white text-sm py-2 px-4 rounded transition-colors">
                                    购买
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl overflow-hidden border border-yellow-100 hover:border-yellow-300 transition-all duration-300 transform hover:-translate-y-2 card-shadow">
                        <div class="h-52 bg-gradient-to-br from-yellow-100 to-yellow-200 flex items-center justify-center">
                            <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/56a2a21f13034b87ac634ac83c06865d~tplv-a9rns2rl98-image.image?rcl=20250814221209E446BF6152BD93C00A8C&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785530&amp;x-signature=9l%2BfhTiwSRooxDQac86F0bAug%2Fk%3D" alt="玲珑果" class="h-full w-full object-cover">
                        </div>
                        <div class="p-5">
                            <div class="flex justify-between items-start mb-3">
                                <h3 class="font-bold text-xl">玲珑果</h3>
                                <span class="bg-yellow-200 text-yellow-700 text-sm px-3 py-1 rounded">师弟喜好</span>
                            </div>
                            <p class="text-sm text-dark/70 mb-4">小巧可爱的果实，味道酸甜可口</p>
                            <div class="flex justify-between items-center">
                                <span class="text-accent font-bold text-lg">120 金币</span>
                                <button class="buy-item bg-yellow-400 hover:bg-yellow-500 text-white text-sm py-2 px-4 rounded transition-colors">
                                    购买
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 人物介绍模块 -->
        <section id="characters-screen" class="hidden min-h-[80vh]">
            <div class="bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 rounded-2xl p-6 md:p-10 shadow-2xl border border-primary/30 h-full">
                <h2 class="text-[clamp(1.8rem,4vw,3rem)] font-bold mb-8 text-shadow-glow text-center">人物介绍</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- 师尊 -->
                    <div class="bg-white rounded-xl overflow-hidden border border-primary/30 card-shadow">
                        <div class="h-64 bg-gradient-to-br from-pink-100 to-pink-200 flex items-center justify-center">
                            <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/0efd01372aed436e8819e8b8c40b8a36~tplv-a9rns2rl98-image.image?rcl=20250814221044EA52DCEBE0F5E1A3357F&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785444&amp;x-signature=ZjNI1qWMQKkcOZ7GHLVfd9MUn1Q%3D" alt="玄尘师尊" class="h-full w-full object-cover">
                        </div>
                        <div class="p-6">
                            <h3 class="text-2xl font-bold mb-2">玄尘师尊</h3>
                            <p class="text-accent mb-4">仙门长老 · 化神期</p>
                            
                            <div class="mb-6">
                                <h4 class="font-bold mb-2 text-lg">人物简介</h4>
                                <p class="text-dark/80 leading-relaxed">
                                    仙门中最年轻的长老，修为高深，外表清冷孤傲，不苟言笑。负责教导内门弟子修炼，对弟子要求严格。看似冷漠，实则非常关心门下弟子。
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 小师弟 -->
                    <div class="bg-white rounded-xl overflow-hidden border border-blue-200 card-shadow">
                        <div class="h-64 bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center">
                            <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/8f107430f62449b2abe78df7ce72e85a~tplv-a9rns2rl98-image.image?rcl=202508142211066D46190E355D77B0CFA6&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1755785468&amp;x-signature=N6Kc42LyOmVmlDobNi%2FIAjyk%2F7M%3D" alt="夜宸小师弟" class="h-full w-full object-cover">
                        </div>
                        <div class="p-6">
                            <h3 class="text-2xl font-bold mb-2">夜宸</h3>
                            <p class="text-blue-500 mb-4">剑修弟子 · 炼气期五层</p>
                            
                            <div class="mb-6">
                                <h4 class="font-bold mb-2 text-lg">人物简介</h4>
                                <p class="text-dark/80 leading-relaxed">
                                    仙门新晋弟子，天赋异禀，尤其在剑术方面进步神速。表面阳光开朗，乖巧懂事，总是"师姐、师姐"地跟在灵月身后。
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 对话界面 -->
        <section id="dialog-screen" class="hidden fixed inset-0 z-50 overflow-hidden">
            <!-- 背景图 -->
            <div id="dialog-background" class="absolute inset-0 bg-clearday transition-all duration-1000"></div>
            
            <!-- 半透明遮罩 -->
            <div class="absolute inset-0 bg-gradient-to-t from-white/70 via-white/40 to-transparent pointer-events-none"></div>
            
            <!-- 角色立绘区域 -->
            <div class="absolute bottom-0 left-0 w-full h-full flex items-end px-10 pb-10">
                <!-- 左侧角色立绘 -->
                <div id="left-character" class="w-1/2 flex justify-start">
                    <!-- 动态加载 -->
                </div>
                
                <!-- 右侧角色立绘 -->
                <div id="right-character" class="w-1/2 flex justify-end">
                    <!-- 动态加载 -->
                </div>
            </div>
            
            <!-- 聊天界面容器 -->
            <div class="absolute bottom-0 left-0 right-0 bg-white/90 bg-blur border-t border-primary/50 transform transition-transform duration-300 translate-y-0" style="border-radius: 20px 20px 0 0;">
                <!-- 聊天头部 -->
                <div class="p-4 border-b border-primary/20 flex items-center justify-between">
                    <div class="flex items-center">
                        <div id="chat-avatar" class="w-10 h-10 rounded-full border-2 border-primary/70 bg-gradient-to-br from-pink-100 to-pink-200 flex items-center justify-center mr-3">
                            <i class="fa fa-user text-lg text-primary/70"></i>
                        </div>
                        <h3 id="chat-name" class="text-xl font-bold"></h3>
                    </div>
                    <div class="flex space-x-3">
                        <button id="toggle-ai-mode" class="p-2 text-secondary hover:bg-secondary/10 rounded-full transition-colors">
                            <i class="fa fa-robot"></i>
                        </button>
                        <button id="return-to-map" class="p-2 text-dark hover:bg-gray-100 rounded-full transition-colors">
                            <i class="fa fa-map-o"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 聊天消息区域 -->
                <div id="message-container" class="p-4 max-h-[60vh] overflow-y-auto space-y-4">
                    <!-- 动态加载 -->
                </div>
                
                <!-- 输入区域 -->
                <div class="p-4 border-t border-primary/20">
                    <!-- 快捷回复 -->
                    <div class="flex flex-wrap gap-2 mb-3">
                        <button class="quick-reply bg-primary/10 hover:bg-primary/20 text-dark px-3 py-1 rounded-full text-sm transition-colors">
                            师尊今日似乎心情不错
                        </button>
                        <button class="quick-reply bg-primary/10 hover:bg-primary/20 text-dark px-3 py-1 rounded-full text-sm transition-colors">
                            这株草药您认识吗？
                        </button>
                        <button class="quick-reply bg-primary/10 hover:bg-primary/20 text-dark px-3 py-1 rounded-full text-sm transition-colors">
                            弟子还有很多要学习的地方
                        </button>
                    </div>
                    
                    <!-- 输入框和发送按钮 -->
                    <div class="flex gap-2">
                        <input type="text" id="player-input" placeholder="输入你想说的话..." class="flex-1 bg-white border border-primary/30 rounded-full px-4 py-3 text-dark focus:outline-none focus:border-primary">
                        <button id="send-message" class="bg-primary hover:bg-primary/80 text-white font-bold p-3 rounded-full transition-all duration-300">
                            <i class="fa fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 通知提示 -->
        <div id="notification" class="fixed top-20 right-4 bg-white border border-primary/50 rounded-lg p-4 shadow-lg transform transition-all duration-500 translate-x-full max-w-xs z-40">
            <h4 class="font-bold mb-1 flex items-center">
                <i class="fa fa-info-circle text-accent mr-2"></i> 提示
            </h4>
            <p id="notification-text" class="text-sm">操作成功！</p>
        </div>
    </main>

    <footer class="bg-white/60 bg-blur border-t border-primary/30 py-4 mt-8 hidden" id="footer">
        <div class="container mx-auto px-4 text-center text-dark/70 text-sm">
            <p>仙缘录-乙女仙侠游戏</p>
        </div>
    </footer>

    <script>
        // 确保页面完全加载后再执行
        window.addEventListener('load', function() {
            // 模拟加载过程
            setTimeout(function() {
                document.getElementById('loader').classList.add('opacity-0', 'pointer-events-none');
                document.getElementById('loader').style.transition = 'opacity 0.5s ease-out';
                
                // 显示页面内容
                setTimeout(function() {
                    document.getElementById('loader').style.display = 'none';
                    document.querySelector('header').classList.remove('hidden');
                    document.getElementById('main-content').classList.remove('hidden');
                    document.getElementById('footer').classList.remove('hidden');
                }, 500);
            }, 1000);
        });

        // 游戏状态管理
        const gameState = {
            gold: 1000,
            screen: 'welcome', // welcome, map, profile, alchemy, shop, characters, dialog
            好感度: {
                师尊: 35,
                师弟: 52,
                魔尊: 0,
                魔尊解锁: false
            },
            currentPill: '回春丹',
            aiMode: false,
            currentLocation: '',
            currentCharacter: '',
            messages: []
        };

        // 角色数据
        const characters = {
            master: {
                name: '玄尘师尊',
                avatar: '<div class="w-10 h-10 rounded-full overflow-hidden"><img src="https://picsum.photos/id/1012/100/100" alt="玄尘师尊头像" class="w-full h-full object-cover"></div>',
                fullImage: '<img src="https://picsum.photos/id/1012/400/800" alt="玄尘师尊" class="h-[70vh] rounded-lg object-cover shadow-lg">',
                position: 'left',
                bgColor: 'bg-primary/10',
                texts: [
                    '灵月，今日的草药采摘得如何了？',
                    '你的炼丹术有进步，但仍需精进。',
                    '这株清心草颇为罕见，你认得它的药性吗？'
                ]
            },
            junior: {
                name: '夜宸小师弟',
                avatar: '<div class="w-10 h-10 rounded-full overflow-hidden"><img src="https://picsum.photos/id/1025/100/100" alt="夜宸小师弟头像" class="w-full h-full object-cover"></div>',
                fullImage: '<img src="https://picsum.photos/id/1025/400/800" alt="夜宸小师弟" class="h-[70vh] rounded-lg object-cover shadow-lg">',
                position: 'left',
                bgColor: 'bg-blue-100',
                texts: [
                    '师姐！我等你好久了，一起去练剑吧？',
                    '师姐的炼丹术越来越厉害了，能不能教教我？',
                    '我在后山发现了一种从没见过的草药，师姐要不要看看？'
                ]
            },
            demon: {
                name: '墨渊魔尊',
                avatar: '<div class="w-10 h-10 rounded-full overflow-hidden"><img src="https://picsum.photos/id/1074/100/100" alt="墨渊魔尊头像" class="w-full h-full object-cover"></div>',
                fullImage: '<img src="https://picsum.photos/id/1074/400/800" alt="墨渊魔尊" class="h-[70vh] rounded-lg object-cover shadow-lg">',
                position: 'left',
                bgColor: 'bg-purple-100',
                texts: [
                    '哦？这不是仙门的小药修吗？',
                    '你的丹药倒是有些意思，可惜投错了师门。',
                    '仙门那群伪君子有什么好？不如跟我回魔界？'
                ]
            }
        };

        // DOM 元素
        const screens = {
            welcome: document.getElementById('welcome-screen'),
            map: document.getElementById('map-screen'),
            profile: document.getElementById('profile-screen'),
            alchemy: document.getElementById('alchemy-screen'),
            shop: document.getElementById('shop-screen'),
            characters: document.getElementById('characters-screen'),
            dialog: document.getElementById('dialog-screen')
        };
        
        const messageContainer = document.getElementById('message-container');
        const notification = document.getElementById('notification');
        const goldCount = document.getElementById('gold-count');
        
        // 切换屏幕
        function showScreen(screenName) {
            // 隐藏所有屏幕
            Object.keys(screens).forEach(key => {
                screens[key].classList.add('hidden');
            });
            
            // 显示目标屏幕
            screens[screenName].classList.remove('hidden');
            gameState.screen = screenName;
            
            // 更新导航按钮状态
            updateNavButtons(screenName);
        }
        
        // 更新导航按钮状态
        function updateNavButtons(activeScreen) {
            // 移除所有按钮的活跃状态
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('nav-button-active');
            });
            
            // 设置当前屏幕按钮为活跃
            switch(activeScreen) {
                case 'map':
                    document.getElementById('map-btn').classList.add('nav-button-active');
                    break;
                case 'profile':
                    document.getElementById('profile-btn').classList.add('nav-button-active');
                    break;
                case 'alchemy':
                    document.getElementById('alchemy-btn').classList.add('nav-button-active');
                    break;
                case 'shop':
                    document.getElementById('shop-btn').classList.add('nav-button-active');
                    break;
                case 'characters':
                    document.getElementById('characters-btn').classList.add('nav-button-active');
                    break;
            }
        }
        
        // 添加消息到聊天界面
        function addMessage(text, sender, characterId = null) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message-appear');
            
            if (sender === 'other') {
                // 对方消息
                const character = characters[characterId];
                messageDiv.innerHTML = `
                    <div class="flex items-start gap-2">
                        <div class="shrink-0">${character.avatar}</div>
                        <div>
                            <div class="${character.bgColor} rounded-t-lg rounded-br-lg px-4 py-2 max-w-[70%]">
                                ${text}
                            </div>
                            <span class="text-xs text-gray-400 ml-2">${getCurrentTime()}</span>
                        </div>
                    </div>
                `;
            } else {
                // 玩家消息
                messageDiv.innerHTML = `
                    <div class="flex items-start justify-end gap-2">
                        <div class="text-right">
                            <div class="bg-accent/20 rounded-t-lg rounded-bl-lg px-4 py-2 max-w-[70%]">
                                ${text}
                            </div>
                            <span class="text-xs text-gray-400 mr-2">${getCurrentTime()}</span>
                        </div>
                        <div class="shrink-0">
                            <div class="w-10 h-10 rounded-full overflow-hidden">
                                <img src="https://picsum.photos/id/64/100/100" alt="你的头像" class="w-full h-full object-cover">
                            </div>
                        </div>
                    </div>
                `;
            }
            
            messageContainer.appendChild(messageDiv);
            gameState.messages.push({ text, sender, timestamp: new Date() });
            
            // 滚动到底部
            messageContainer.scrollTop = messageContainer.scrollHeight;
        }
        
        // 获取当前时间
        function getCurrentTime() {
            const now = new Date();
            return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        }
        
        // 显示对话界面
        function showVisualDialog(characterId, location) {
            const character = characters[characterId];
            if (!character) return;
            
            // 保存当前状态
            gameState.currentCharacter = characterId;
            gameState.currentLocation = location;
            gameState.messages = [];
            
            // 清空消息容器
            messageContainer.innerHTML = '';
            
            // 设置背景
            const backgroundEl = document.getElementById('dialog-background');
            backgroundEl.className = '';
            backgroundEl.classList.add('absolute', 'inset-0', `bg-${location}`, 'transition-all', 'duration-1000');
            
            // 设置角色立绘
            document.getElementById('left-character').innerHTML = '';
            document.getElementById('right-character').innerHTML = '';
            
            const characterContainer = document.getElementById(`${character.position}-character`);
            characterContainer.innerHTML = character.fullImage;
            
            // 设置聊天头部
            document.getElementById('chat-avatar').outerHTML = character.avatar;
            document.getElementById('chat-name').textContent = character.name;
            
            // 添加初始对话
            const randomText = character.texts[Math.floor(Math.random() * character.texts.length)];
            addMessage(randomText, 'other', characterId);
            
            // 显示对话屏幕
            screens.dialog.classList.remove('hidden');
            gameState.screen = 'dialog';
        }
        
        // 显示通知
        function showNotification(message) {
            document.getElementById('notification-text').textContent = message;
            notification.classList.remove('translate-x-full');
            
            // 3秒后隐藏
            setTimeout(() => {
                notification.classList.add('translate-x-full');
            }, 3000);
        }
        
        // 更新金币
        function updateGold(amount) {
            gameState.gold += amount;
            goldCount.textContent = gameState.gold;
            
            if (amount > 0) {
                showNotification(`获得 ${amount} 金币！`);
            } else if (amount < 0) {
                showNotification(`花费 ${-amount} 金币！`);
            }
        }
        
        // 开始炼丹
        function startAlchemy() {
            const progressEl = document.getElementById('alchemy-progress');
            const startBtn = document.getElementById('start-alchemy');
            
            startBtn.disabled = true;
            startBtn.classList.add('opacity-50', 'cursor-not-allowed');
            
            let progress = 0;
            progressEl.textContent = '0%';
            
            const interval = setInterval(() => {
                progress += 10;
                progressEl.style.borderTopWidth = '4px';
                progressEl.style.transform = `rotate(${progress * 3.6}deg)`;
                progressEl.textContent = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    progressEl.textContent = '完成';
                    progressEl.style.borderTopWidth = '0';
                    progressEl.style.transform = 'rotate(0)';
                    
                    showNotification(`成功炼制出 ${gameState.currentPill}！`);
                    startBtn.disabled = false;
                    startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }, 300);
        }
        
        // 选择丹方
        function selectPill(pillName) {
            gameState.currentPill = pillName;
            
            document.querySelectorAll('.select-pill').forEach(btn => {
                if (btn.dataset.pill === pillName) {
                    btn.classList.add('bg-primary');
                    btn.classList.remove('bg-primary/30', 'hover:bg-primary/50');
                } else {
                    btn.classList.remove('bg-primary');
                    btn.classList.add('bg-primary/30', 'hover:bg-primary/50');
                }
            });
        }
        
        // 发送玩家消息
        function sendPlayerMessage() {
            const inputEl = document.getElementById('player-input');
            const message = inputEl.value.trim();
            
            if (message) {
                inputEl.value = '';
                addMessage(message, 'player');
                
                // 简单回应
                setTimeout(() => {
                    const character = characters[gameState.currentCharacter];
                    let response = '';
                    
                    if (character.name === '玄尘师尊') {
                        response = "我明白了。你的想法有几分道理，不过还需再斟酌。";
                    } else if (character.name === '夜宸小师弟') {
                        response = "师姐说的是！我完全同意！那我们接下来要做什么呢？";
                    } else {
                        response = "有意思的想法。不过以你现在的能力，恐怕还做不到。";
                    }
                    
                    addMessage(response, 'other', gameState.currentCharacter);
                    
                    // 增加好感度
                    if (gameState.currentCharacter === 'master') {
                        gameState.好感度.师尊 += 1;
                    } else if (gameState.currentCharacter === 'junior') {
                        gameState.好感度.师弟 += 2;
                    } else if (gameState.currentCharacter === 'demon') {
                        gameState.好感度.魔尊 += 1;
                    }
                }, 800);
            }
        }
        
        // 初始化事件监听
        function initEventListeners() {
            // 开始游戏按钮
            const startBtn = document.getElementById('start-btn');
            if (startBtn) {
                startBtn.addEventListener('click', () => {
                    showScreen('map');
                });
            }
            
            // 导航按钮 - PC端
            document.getElementById('map-btn')?.addEventListener('click', () => showScreen('map'));
            document.getElementById('profile-btn')?.addEventListener('click', () => showScreen('profile'));
            document.getElementById('alchemy-btn')?.addEventListener('click', () => showScreen('alchemy'));
            document.getElementById('shop-btn')?.addEventListener('click', () => showScreen('shop'));
            document.getElementById('characters-btn')?.addEventListener('click', () => showScreen('characters'));
            
            // 移动端菜单
            document.getElementById('mobile-menu-btn')?.addEventListener('click', () => {
                const mobileMenu = document.getElementById('mobile-menu');
                mobileMenu.classList.toggle('hidden');
            });
            
            // 移动端导航
            document.getElementById('map-btn-mobile')?.addEventListener('click', () => {
                showScreen('map');
                document.getElementById('mobile-menu').classList.add('hidden');
            });
            
            document.getElementById('profile-btn-mobile')?.addEventListener('click', () => {
                showScreen('profile');
                document.getElementById('mobile-menu').classList.add('hidden');
            });
            
            document.getElementById('alchemy-btn-mobile')?.addEventListener('click', () => {
                showScreen('alchemy');
                document.getElementById('mobile-menu').classList.add('hidden');
            });
            
            document.getElementById('shop-btn-mobile')?.addEventListener('click', () => {
                showScreen('shop');
                document.getElementById('mobile-menu').classList.add('hidden');
            });
            
            document.getElementById('characters-btn-mobile')?.addEventListener('click', () => {
                showScreen('characters');
                document.getElementById('mobile-menu').classList.add('hidden');
            });
            
            // 地图地点点击
            function setupMapLocations() {
                const locations = document.querySelectorAll('.map-location');
                locations.forEach(location => {
                    location.addEventListener('click', function() {
                        const locationType = this.dataset.location;
                        const characterId = this.dataset.character;
                        showVisualDialog(characterId, locationType);
                    });
                });
            }
            setupMapLocations();
            
            // 返回地图
            document.getElementById('return-to-map')?.addEventListener('click', () => {
                showScreen('map');
            });
            
            // 炼丹按钮
            document.getElementById('start-alchemy')?.addEventListener('click', startAlchemy);
            
            // 选择丹方
            document.querySelectorAll('.select-pill').forEach(btn => {
                btn.addEventListener('click', () => {
                    selectPill(btn.dataset.pill);
                });
            });
            
            // 出售丹药
            document.querySelectorAll('.sell-pill').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const pillEl = e.target.closest('div[class*="p-4"]');
                    const pillName = pillEl.querySelector('h4').textContent;
                    const valueText = pillEl.querySelector('.text-accent:last-child').textContent;
                    const value = parseInt(valueText.match(/\d+/)[0]);
                    
                    updateGold(value);
                    showNotification(`成功出售 ${pillName}，获得 ${value} 金币！`);
                });
            });
            
            // 购买物品
            document.querySelectorAll('.buy-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const itemEl = e.target.closest('div[class*="bg-white"]');
                    const itemName = itemEl.querySelector('h3').textContent;
                    const priceText = itemEl.querySelector('.text-accent.font-bold').textContent;
                    const price = parseInt(priceText.match(/\d+/)[0]);
                    
                    if (gameState.gold >= price) {
                        updateGold(-price);
                        showNotification(`成功购买 ${itemName}！`);
                    } else {
                        showNotification('金币不足，无法购买！');
                    }
                });
            });
            
            // 查看人物详情
            document.querySelectorAll('.view-character-details').forEach(btn => {
                btn.addEventListener('click', () => {
                    showScreen('characters');
                });
            });
            
            // 发送消息
            document.getElementById('send-message')?.addEventListener('click', sendPlayerMessage);
            
            // 回车发送
            document.getElementById('player-input')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendPlayerMessage();
                }
            });
            
            // 快捷回复
            document.querySelectorAll('.quick-reply').forEach(btn => {
                btn.addEventListener('click', () => {
                    const inputEl = document.getElementById('player-input');
                    inputEl.value = btn.textContent;
                    sendPlayerMessage();
                });
            });
            
            // 切换AI模式
            document.getElementById('toggle-ai-mode')?.addEventListener('click', () => {
                gameState.aiMode = !gameState.aiMode;
                const btn = document.getElementById('toggle-ai-mode');
                
                if (gameState.aiMode) {
                    btn.classList.add('bg-secondary/20');
                    showNotification('已开启AI对话模式');
                } else {
                    btn.classList.remove('bg-secondary/20');
                    showNotification('已关闭AI对话模式');
                }
            });
        }
        
        // 页面加载完成后初始化
        window.addEventListener('load', function() {
            // 等待加载动画完成后初始化事件监听
            setTimeout(initEventListeners, 1500);
        });
    </script>


    </body></html>